<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/fragment_youtube_player_root"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="?attr/colorSurface">

    <!-- Mini Player Header / Controls (Visible only when minimized, or handled via MotionLayout) -->
    <!-- For simplicity in the first pass, we will use the existing layout structure
         and tweak it. The parent container's size change will drive the visibility
         of these elements if we use a MotionLayout in the parent.
         However, for a true YouTube like experience, we usually swap views.
    -->

    <androidx.constraintlayout.motion.widget.MotionLayout
        android:id="@+id/player_motion_layout"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:layout_behavior="@string/appbar_scrolling_view_behavior"
        app:layoutDescription="@xml/fragment_player_scene">

        <!-- Initial Player View (The video surface) -->
        <FrameLayout
            android:id="@+id/playerContainer"
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:background="@android:color/black"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintDimensionRatio="H,16:9">

            <com.pierfrancescosoffritti.androidyoutubeplayer.core.player.views.YouTubePlayerView
                android:id="@+id/YtPlayer"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:enableAutomaticInitialization="false" />
        </FrameLayout>

        <!-- Mini Player Title (Visible in Start/Mini state) -->
        <com.google.android.material.textview.MaterialTextView
            android:id="@+id/miniPlayerTitle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="12dp"
            android:layout_marginEnd="8dp"
            android:ellipsize="end"
            android:fontFamily="@font/circular_spotify"
            android:maxLines="1"
            android:text="@string/video_title"
            android:textColor="?attr/colorOnSurface"
            android:textSize="14sp"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toStartOf="@id/btnMiniPlay"
            app:layout_constraintStart_toEndOf="@id/playerContainer"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Mini Player Play Button -->
        <ImageButton
            android:id="@+id/btnMiniPlay"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/play_arrow_24dp"
            android:contentDescription="Play"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toStartOf="@id/btnMiniClose"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Mini Player Close Button -->
        <ImageButton
            android:id="@+id/btnMiniClose"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/close_24dp"
            android:contentDescription="Close"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Collapse Button (Visible in End/Full state) -->
        <ImageButton
            android:id="@+id/btnCollapse"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginTop="8dp"
            android:layout_marginStart="8dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/ic_arrow_down"
            android:contentDescription="Collapse"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            android:alpha="0"
            app:tint="?attr/colorOnSurface"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />


        <!-- Expanded Content (Scrollview with details) -->
        <androidx.core.widget.NestedScrollView
            android:id="@+id/nestedScrollView"
            android:layout_width="match_parent"
            android:layout_height="0dp"
            android:fillViewport="true"
            app:layout_constraintTop_toBottomOf="@id/playerContainer"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <androidx.constraintlayout.widget.ConstraintLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:paddingBottom="16dp">

                <!-- Title -->
                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/textTitle"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="16dp"
                    android:layout_marginTop="12dp"
                    android:layout_marginEnd="16dp"
                    android:fontFamily="@font/circular_spotify"
                    android:text="@string/video_title"
                    android:textSize="18sp"
                    android:textStyle="bold"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toTopOf="parent" />

                <!-- Metadata Row -->
                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/metaInfoText"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:alpha="0.7"
                    android:fontFamily="@font/proxima_nova"
                    android:text="1.2M views â€¢ 2 years ago"
                    android:textSize="12sp"
                    app:layout_constraintEnd_toEndOf="@id/textTitle"
                    app:layout_constraintStart_toStartOf="@id/textTitle"
                    app:layout_constraintTop_toBottomOf="@id/textTitle" />

                <!-- Channel Row -->
                <com.google.android.material.imageview.ShapeableImageView
                    android:id="@+id/channelImage"
                    android:layout_width="40dp"
                    android:layout_height="40dp"
                    android:layout_marginTop="16dp"
                    android:scaleType="centerCrop"
                    app:layout_constraintStart_toStartOf="@id/textTitle"
                    app:layout_constraintTop_toBottomOf="@id/metaInfoText"
                    app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full"
                    tools:srcCompat="@tools:sample/avatars" />

                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/channelName"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="12dp"
                    android:layout_marginEnd="16dp"
                    android:ellipsize="end"
                    android:fontFamily="@font/circular_spotify"
                    android:maxLines="1"
                    android:text="@string/channel_title"
                    android:textSize="14sp"
                    android:textStyle="bold"
                    app:layout_constraintBottom_toTopOf="@id/channelSubscribers"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toEndOf="@id/channelImage"
                    app:layout_constraintTop_toTopOf="@id/channelImage"
                    app:layout_constraintVertical_chainStyle="packed" />

                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/channelSubscribers"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:alpha="0.7"
                    android:fontFamily="@font/proxima_nova"
                    android:text="1M Subscribers"
                    android:textSize="12sp"
                    app:layout_constraintBottom_toBottomOf="@id/channelImage"
                    app:layout_constraintEnd_toEndOf="@id/channelName"
                    app:layout_constraintStart_toStartOf="@id/channelName"
                    app:layout_constraintTop_toBottomOf="@id/channelName" />

                <!-- Actions ScrollView -->
                <HorizontalScrollView
                    android:id="@+id/actionsScroll"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:clipToPadding="false"
                    android:paddingStart="16dp"
                    android:paddingEnd="16dp"
                    android:scrollbars="none"
                    app:layout_constraintTop_toBottomOf="@id/channelImage">

                    <LinearLayout
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:gravity="center_vertical"
                        android:orientation="horizontal">

                        <com.google.android.material.checkbox.MaterialCheckBox
                            android:id="@+id/btnLike"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:button="@null"
                            android:drawableStart="@drawable/ic_like_video"
                            android:drawablePadding="8dp"
                            android:gravity="center"
                            android:minHeight="40dp"
                            android:paddingStart="16dp"
                            android:paddingEnd="16dp"
                            android:text="@string/like"
                            app:checkedIcon="@drawable/ic_favourite" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnAddToPlaylist"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:minHeight="40dp"
                            android:text="Save"
                            app:icon="@drawable/round_add_24" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnCustomPlaylist"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:minHeight="40dp"
                            android:text="Playlist"
                            app:icon="@drawable/ic_library" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnPip"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:minHeight="40dp"
                            android:text="PIP"
                            app:icon="@drawable/ic_picture_in_picture" />

                    </LinearLayout>
                </HorizontalScrollView>

                <View
                    android:id="@+id/divider1"
                    android:layout_width="match_parent"
                    android:layout_height="1dp"
                    android:layout_marginTop="16dp"
                    android:alpha="0.1"
                    android:background="?attr/colorOnSurface"
                    app:layout_constraintTop_toBottomOf="@id/actionsScroll" />

                <!-- Description -->
                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/textDescription"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_margin="16dp"
                    android:background="@drawable/bg_rounded_card"
                    android:backgroundTint="?attr/colorSurfaceVariant"
                    android:fontFamily="@font/proxima_nova"
                    android:padding="12dp"
                    android:text="@string/video_title"
                    android:textColor="?attr/colorOnSurfaceVariant"
                    android:textSize="12sp"
                    android:maxLines="3"
                    android:ellipsize="end"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toBottomOf="@id/divider1" />

                <!-- Show More Button -->
                <com.google.android.material.button.MaterialButton
                    android:id="@+id/btnShowMore"
                    style="@style/Widget.Material3.Button.TextButton"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:text="Show More"
                    android:textSize="12sp"
                    app:layout_constraintStart_toStartOf="@id/textDescription"
                    app:layout_constraintTop_toBottomOf="@id/textDescription" />

                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/textRelated"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="16dp"
                    android:layout_marginTop="24dp"
                    android:fontFamily="@font/circular_spotify"
                    android:text="More from this channel"
                    android:textSize="16sp"
                    android:textStyle="bold"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toBottomOf="@id/btnShowMore" />

                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/channelsPlaylist"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="12dp"
                    android:clipToPadding="false"
                    android:nestedScrollingEnabled="false"
                    android:paddingBottom="80dp"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toBottomOf="@id/textRelated" />

            </androidx.constraintlayout.widget.ConstraintLayout>

        </androidx.core.widget.NestedScrollView>

    </androidx.constraintlayout.motion.widget.MotionLayout>

</androidx.coordinatorlayout.widget.CoordinatorLayout>
