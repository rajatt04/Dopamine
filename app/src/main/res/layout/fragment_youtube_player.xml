<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/fragment_youtube_player_root"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="?attr/colorSurface">

    <!-- Mini Player Header / Controls (Visible only when minimized, or handled via MotionLayout) -->
    <!-- For simplicity in the first pass, we will use the existing layout structure
         and tweak it. The parent container's size change will drive the visibility
         of these elements if we use a MotionLayout in the parent.
         However, for a true YouTube like experience, we usually swap views.
    -->

    <androidx.constraintlayout.motion.widget.MotionLayout
        android:id="@+id/player_motion_layout"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="?attr/colorSurface"
        app:layout_behavior="@string/appbar_scrolling_view_behavior"
        app:layoutDescription="@xml/fragment_player_scene">

        <!-- Initial Player View (The video surface) -->
        <!-- Wrapped in Card for rounded corners in full view if desired, or just standard view -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/playerContainer"
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:backgroundTint="@android:color/black"
            app:cardCornerRadius="0dp"
            app:cardElevation="0dp"
            app:strokeWidth="0dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintDimensionRatio="H,16:9">

            <com.pierfrancescosoffritti.androidyoutubeplayer.core.player.views.YouTubePlayerView
                android:id="@+id/YtPlayer"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:enableAutomaticInitialization="false" />
        </com.google.android.material.card.MaterialCardView>

        <!-- Mini Player Title (Visible in Start/Mini state) -->
        <com.google.android.material.textview.MaterialTextView
            android:id="@+id/miniPlayerTitle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="16dp"
            android:layout_marginEnd="8dp"
            android:ellipsize="end"
            android:fontFamily="@font/circular_spotify"
            android:maxLines="1"
            android:text="@string/video_title"
            android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
            android:textColor="?attr/colorOnSurface"
            android:textStyle="bold"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toStartOf="@id/btnMiniPlay"
            app:layout_constraintStart_toEndOf="@id/playerContainer"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Mini Player Play Button -->
        <ImageButton
            android:id="@+id/btnMiniPlay"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/ic_play_arrow"
            android:contentDescription="Play"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            app:tint="?attr/colorOnSurface"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toStartOf="@id/btnMiniClose"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Mini Player Close Button -->
        <ImageButton
            android:id="@+id/btnMiniClose"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/ic_close"
            android:contentDescription="Close"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            app:tint="?attr/colorOnSurface"
            app:layout_constraintBottom_toBottomOf="@id/playerContainer"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="@id/playerContainer" />

        <!-- Collapse Button (Visible in End/Full state) -->
        <ImageButton
            android:id="@+id/btnCollapse"
            android:layout_width="48dp"
            android:layout_height="48dp"
            android:layout_marginTop="8dp"
            android:layout_marginStart="8dp"
            android:background="@drawable/bg_circle_glass"
            android:src="@drawable/ic_arrow_down"
            android:contentDescription="Collapse"
            android:clickable="true"
            android:focusable="true"
            android:elevation="10dp"
            android:alpha="0"
            app:tint="?attr/colorOnSurface"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />


        <!-- Expanded Content (Scrollview with details) -->
        <androidx.core.widget.NestedScrollView
            android:id="@+id/nestedScrollView"
            android:layout_width="match_parent"
            android:layout_height="0dp"
            android:fillViewport="true"
            android:background="?attr/colorSurface"
            app:layout_constraintTop_toBottomOf="@id/playerContainer"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <androidx.constraintlayout.widget.ConstraintLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:paddingBottom="24dp">

                <!-- Title -->
                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/textTitle"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="20dp"
                    android:layout_marginTop="16dp"
                    android:layout_marginEnd="20dp"
                    android:fontFamily="@font/circular_spotify"
                    android:text="@string/video_title"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textStyle="bold"
                    android:textColor="?attr/colorOnSurface"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toTopOf="parent" />

                <!-- Metadata Row -->
                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/metaInfoText"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="6dp"
                    android:fontFamily="@font/proxima_nova"
                    android:text="1.2M views â€¢ 2 years ago"
                    android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                    android:textColor="?attr/colorOnSurfaceVariant"
                    app:layout_constraintEnd_toEndOf="@id/textTitle"
                    app:layout_constraintStart_toStartOf="@id/textTitle"
                    app:layout_constraintTop_toBottomOf="@id/textTitle" />

                <!-- Channel Card -->
                <com.google.android.material.card.MaterialCardView
                    android:id="@+id/channelCard"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="16dp"
                    android:layout_marginEnd="16dp"
                    android:layout_marginTop="20dp"
                    style="?attr/materialCardViewFilledStyle"
                    app:cardBackgroundColor="@android:color/transparent"
                    app:strokeWidth="0dp"
                    app:layout_constraintTop_toBottomOf="@id/metaInfoText">

                    <androidx.constraintlayout.widget.ConstraintLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content">
                        
                        <com.google.android.material.imageview.ShapeableImageView
                            android:id="@+id/channelImage"
                            android:layout_width="48dp"
                            android:layout_height="48dp"
                            android:scaleType="centerCrop"
                            app:layout_constraintStart_toStartOf="parent"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintBottom_toBottomOf="parent"
                            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full"
                            tools:srcCompat="@tools:sample/avatars" />

                        <com.google.android.material.textview.MaterialTextView
                            android:id="@+id/channelName"
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_marginStart="12dp"
                            android:layout_marginEnd="16dp"
                            android:ellipsize="end"
                            android:fontFamily="@font/circular_spotify"
                            android:maxLines="1"
                            android:text="@string/channel_title"
                            android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                            android:textStyle="bold"
                            android:textColor="?attr/colorOnSurface"
                            app:layout_constraintBottom_toTopOf="@id/channelSubscribers"
                            app:layout_constraintEnd_toStartOf="@id/btnSubscribe"
                            app:layout_constraintStart_toEndOf="@id/channelImage"
                            app:layout_constraintTop_toTopOf="@id/channelImage"
                            app:layout_constraintVertical_chainStyle="packed" />

                        <com.google.android.material.textview.MaterialTextView
                            android:id="@+id/channelSubscribers"
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:fontFamily="@font/proxima_nova"
                            android:text="1M Subscribers"
                            android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                            android:textColor="?attr/colorOnSurfaceVariant"
                            app:layout_constraintBottom_toBottomOf="@id/channelImage"
                            app:layout_constraintEnd_toEndOf="@id/channelName"
                            app:layout_constraintStart_toStartOf="@id/channelName"
                            app:layout_constraintTop_toBottomOf="@id/channelName" />
                            
                         <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnSubscribe"
                            style="@style/Widget.Material3.Button.TonalButton"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="Subscribe"
                            app:layout_constraintEnd_toEndOf="parent"
                            app:layout_constraintTop_toTopOf="parent"
                            app:layout_constraintBottom_toBottomOf="parent"/>

                    </androidx.constraintlayout.widget.ConstraintLayout>
                </com.google.android.material.card.MaterialCardView>

                <!-- Actions ScrollView -->
                <HorizontalScrollView
                    android:id="@+id/actionsScroll"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="20dp"
                    android:clipToPadding="false"
                    android:paddingStart="16dp"
                    android:paddingEnd="16dp"
                    android:scrollbars="none"
                    app:layout_constraintTop_toBottomOf="@id/channelCard">

                    <LinearLayout
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:gravity="center_vertical"
                        android:orientation="horizontal">

                        <!-- Like Button (More Expressive Pill Shape) -->
                        <com.google.android.material.checkbox.MaterialCheckBox
                            android:id="@+id/btnLike"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:button="@null"
                            android:drawableStart="@drawable/ic_like_video"
                            android:drawablePadding="8dp"
                            android:gravity="center"
                            android:minHeight="44dp"
                            android:paddingStart="20dp"
                            android:paddingEnd="20dp"
                            android:text="@string/like"
                            android:textColor="?attr/colorOnSecondaryContainer"
                            app:checkedIcon="@drawable/ic_favourite"
                            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full"
                             />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnAddToPlaylist"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:minHeight="44dp"
                            android:text="Save"
                            android:textColor="?attr/colorOnSecondaryContainer"
                            app:icon="@drawable/round_add_24"
                            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnCustomPlaylist"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp"
                            android:minHeight="44dp"
                            android:text="Playlist"
                            android:textColor="?attr/colorOnSecondaryContainer"
                            app:icon="@drawable/ic_library"
                            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnPip"
                            style="@style/Widget.Material3.Button.TonalButton.Icon"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:minHeight="44dp"
                            android:text="PIP"
                            android:textColor="?attr/colorOnSecondaryContainer"
                            app:icon="@drawable/ic_picture_in_picture"
                            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Full" />

                    </LinearLayout>
                </HorizontalScrollView>

                <!-- Description Card -->
                <com.google.android.material.card.MaterialCardView
                    android:id="@+id/descriptionCard"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_margin="16dp"
                    style="?attr/materialCardViewFilledStyle"
                    app:cardBackgroundColor="?attr/colorSurfaceContainer"
                    app:cardCornerRadius="12dp"
                    app:strokeWidth="0dp"
                    app:layout_constraintTop_toBottomOf="@id/actionsScroll">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:padding="12dp">
                        
                        <com.google.android.material.textview.MaterialTextView
                            android:id="@+id/textDescription"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:fontFamily="@font/proxima_nova"
                            android:text="@string/video_title"
                            android:textColor="?attr/colorOnSurfaceVariant"
                            android:textSize="14sp"
                            android:maxLines="3"
                            android:ellipsize="end" />

                        <com.google.android.material.button.MaterialButton
                            android:id="@+id/btnShowMore"
                            style="@style/Widget.Material3.Button.TextButton"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="Show More"
                            android:textSize="12sp"
                            android:layout_gravity="start"
                            android:padding="0dp"
                            android:minHeight="32dp" />
                    </LinearLayout>
                </com.google.android.material.card.MaterialCardView>

                <com.google.android.material.textview.MaterialTextView
                    android:id="@+id/textRelated"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="20dp"
                    android:layout_marginTop="24dp"
                    android:fontFamily="@font/circular_spotify"
                    android:text="More from this channel"
                    android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                    android:textStyle="bold"
                    android:textColor="?attr/colorOnSurface"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toBottomOf="@id/descriptionCard" />

                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/channelsPlaylist"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:clipToPadding="false"
                    android:nestedScrollingEnabled="false"
                    android:paddingBottom="80dp"
                    app:layout_constraintEnd_toEndOf="parent"
                    app:layout_constraintStart_toStartOf="parent"
                    app:layout_constraintTop_toBottomOf="@id/textRelated" />

            </androidx.constraintlayout.widget.ConstraintLayout>

        </androidx.core.widget.NestedScrollView>

    </androidx.constraintlayout.motion.widget.MotionLayout>

</androidx.coordinatorlayout.widget.CoordinatorLayout>
